<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Issue Tracker Helpdesk</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(90deg, #e3f2fd, #ffffff, #e3f2fd);
  margin: 0;
}

.container {
  max-width: 900px;
  margin: 40px auto;
  background: #fff;
  padding: 30px;
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}

/* HEADER */
.header {
  text-align: center;
  padding: 25px;
  margin-bottom: 30px;
  border-radius: 12px;
  background: linear-gradient(135deg, #42a5f5, #64b5f6);
  color: #fff;
}

.header .icon {
  font-size: 56px;
  margin-bottom: 6px;
}

/* SEARCH */
input {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border-radius: 10px;
  border: 1px solid #cfd8dc;
  margin-bottom: 24px;
}

/* LIST */
.issue-item {
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  margin-bottom: 14px;
  overflow: hidden;
}

.issue-header {
  padding: 16px;
  font-weight: bold;
  color: #1976d2;
  cursor: pointer;
  background: #fafafa;
}

.issue-header:hover {
  background: #f1f8ff;
}

.issue-detail {
  display: none;
  padding: 16px;
  background: #fff;
  border-top: 1px dashed #cfd8dc;
}

.section {
  margin-bottom: 14px;
}

.section h4 {
  margin: 0 0 6px;
  color: #1565c0;
}

img {
  max-width: 100%;
  border-radius: 10px;
  margin-top: 10px;
}

/* FOOTER */
.footer {
  text-align: center;
  margin-top: 40px;
  color: #777;
  font-size: 13px;
}
</style>
</head>

<body>
<div class="container">

  <div class="header">
    <div class="icon">ðŸ“˜ðŸ’¡</div>
    <h1>Issue Tracker Helpdesk</h1>
    <p>Pusat solusi & panduan penanganan issue</p>
  </div>

  <input id="search" placeholder="Cari issue..." />

  <div id="list"></div>

  <div class="footer">
    Â© <span id="year"></span> Helpdesk
  </div>

</div>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

/* SHEET URL (ANTI CACHE) */
const SHEET_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQCLXvz4_F7EfUppPoKWSKQawlesCjiYHhceQCIEDoV8ntbDjFrvKUorP416AGydpWYmxWlOLA3b1JL/pub?gid=0&single=true&output=csv&t="
  + Date.now();

let issues = [];
let opened = null;

/* FETCH */
fetch(SHEET_URL)
  .then(r => r.text())
  .then(csv => {
    const rows = csv.trim().split("\n").slice(1);
    issues = rows.map(r => {
      const c = r.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
      return {
        issue: c[0]?.replace(/"/g,"").trim(),
        solusi: c[1]?.replace(/"/g,"").trim(),
        langkah: c[2]?.replace(/"/g,"").trim(),
        image_id: c[3]?.replace(/"/g,"").trim()
      };
    });
    render(issues);
  });

function render(data) {
  const list = document.getElementById("list");
  list.innerHTML = "";

  if (!data.length) {
    list.innerHTML = "<div style='color:#999'>Issue tidak ditemukan</div>";
    return;
  }

  data.forEach(item => {
    const wrap = document.createElement("div");
    wrap.className = "issue-item";

    const detail = document.createElement("div");
    detail.className = "issue-detail";

    detail.innerHTML = `
      <div class="section">
        <h4>Solusi</h4>
        <p>${item.solusi}</p>
      </div>
      <div class="section">
        <h4>Langkah-langkah</h4>
        <p>${item.langkah}</p>
      </div>
      ${
        item.image_id && item.image_id !== "kosong"
          ? `<img src="https://drive.google.com/uc?id=${item.image_id}">`
          : ""
      }
    `;

    const header = document.createElement("div");
    header.className = "issue-header";
    header.textContent = item.issue;

    header.onclick = () => {
      if (opened && opened !== detail) {
        opened.style.display = "none";
      }
      detail.style.display =
        detail.style.display === "block" ? "none" : "block";
      opened = detail.style.display === "block" ? detail : null;
    };

    wrap.appendChild(header);
    wrap.appendChild(detail);
    list.appendChild(wrap);
  });
}

/* SEARCH â†’ ISSUE ONLY */
document.getElementById("search").addEventListener("input", e => {
  const key = e.target.value.toLowerCase();
  render(
    issues.filter(i => i.issue.toLowerCase().includes(key))
  );
});
</script>

</body>
</html>
